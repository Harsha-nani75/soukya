<div class="container mt-4">
      <h4 class="mb-3">{{ isEditMode ? 'Edit Patient' : 'Add Patient' }}</h4>

  <form (ngSubmit)="onSubmit()" #patientForm="ngForm">

    <div class="card shadow-sm p-4 mb-4 animate__animated animate__fadeInUp patient-card">
  <div class="row">
    <h4 class="mb-3"><i class="fas fa-user text-primary me-2"></i> Patient Details</h4>

    <!-- Left side: Avatar -->
    <div class="col-md-4 d-flex justify-content-center align-items-start">
      <div class="text-center">
        <div class="d-flex justify-content-center my-3">
          <img 
            [src]="previewUrl || patient.photo || '../../../assets/image.png'" 
            alt="Patient Photo" 
            class="patient-photo"
            (click)="fileInput.click()"
          />
        </div>

        <input 
          type="file" 
          #fileInput 
          (change)="onFileSelected($event)" 
          accept="image/*" 
          style="display:none"
        />
        <p class="mt-2 text-muted">Click to upload photo</p>
      </div>
    </div>

    <!-- Right side: Input fields -->
    <div class="col-md-8">
      <div class="row">
        <div class="col-md-4 mb-2">
          <input type="text" class="form-control" placeholder="First Name" [(ngModel)]="patient.name" name="name" required>
        </div>
        <div class="col-md-4 mb-2">
          <input type="text" class="form-control" placeholder="Last Name" [(ngModel)]="patient.lname" name="lname">
        </div>
        <div class="col-md-4 mb-2">
          <input type="text" class="form-control" placeholder="Surname" [(ngModel)]="patient.sname" name="sname">
        </div>

        <div class="col-md-6 mb-2">
          <div class="input-group">
            <select class="form-select abb-select" [(ngModel)]="patient.abb" name="abb">
              <option value="s/o">S/O</option>
              <option value="w/o">W/O</option>
              <option value="h/o">H/O</option>
              <option value="d/o">D/O</option>
            </select>
            <input type="text" class="form-control" placeholder="Relative Name" [(ngModel)]="patient.abbname" name="abbname">
          </div>
        </div>

        <div class="col-md-6 mb-2">
          <select class="form-select" [(ngModel)]="patient.gender" name="gender">
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="col-md-4 mb-2">
          <input type="date" class="form-control" [(ngModel)]="patient.dob" name="dob" (change)="calculateAge()">
        </div>
        <div class="col-md-4 mb-2">
          <input type="text" class="form-control" placeholder="Age" [(ngModel)]="patient.age" name="age" readonly>
        </div>
        <div class="col-md-4 mb-2">
          <input type="text" class="form-control" placeholder="Occupation" [(ngModel)]="patient.ocupation" name="ocupation">
        </div>

        <div class="col-md-6 mb-2">
          <input type="text" class="form-control" placeholder="Phone Number" [(ngModel)]="patient.phone" name="phone">
        </div>
        <div class="col-md-6 mb-2">
          <input type="email" class="form-control" placeholder="Email" [(ngModel)]="patient.email" name="email">
        </div>
      </div>
    </div>
  </div>
</div>

        <!-- ========================= -->
        <!-- Address Information -->
        <!-- ========================= -->
       <div class="card shadow-sm p-4 mt-4 animate__animated animate__fadeInUp">
  <h5 class="mb-3"><i class="fas fa-map-marker-alt text-primary me-2"></i> Address Details</h5>

  <div class="row g-3">
    <div class="col-12">
      <select class="form-select" [(ngModel)]="patient.rstatus" name="rstatus">
        <option value="India Resident">India Resident</option>
        <option value="NRI">NRI</option>
        <option value="PIO">PIO</option>
        <option value="Foriegn National">Foriegn National</option>
      </select>
    </div>

    <div class="col-12">
      <input type="text" class="form-control" [(ngModel)]="patient.raddress" name="raddress" placeholder="Current Residential Address">
    </div>

    <div class="col-md-4">
      <input type="text" class="form-control" [(ngModel)]="patient.rcity" name="rcity" placeholder="City">
    </div>
    <div class="col-md-4">
      <input type="text" class="form-control" [(ngModel)]="patient.rstate" name="rstate" placeholder="State">
    </div>
    <div class="col-md-4">
      <input type="text" class="form-control" [(ngModel)]="patient.rzipcode" name="rzipcode" placeholder="Zipcode">
    </div>

    <div class="col-12">
      <input type="text" class="form-control" [(ngModel)]="patient.paddress" name="paddress" placeholder="Permanent Address">
    </div>
    <div class="col-md-6">
      <input type="text" class="form-control" [(ngModel)]="patient.pcity" name="pcity" placeholder="City">
    </div>
    <div class="col-md-3">
      <input type="text" class="form-control" [(ngModel)]="patient.pstate" name="pstate" placeholder="State">
    </div>
    <div class="col-md-3">
      <input type="text" class="form-control" [(ngModel)]="patient.pzipcode" name="pzipcode" placeholder="Zipcode">
    </div>

    <div class="col-12">
      <select class="form-select" [(ngModel)]="patient.addressTextProof" name="addressTextProof">
        <option value="Aadhar">Copy of Aadhar card</option>
        <option value="Voter ID">Voter ID</option>
        <option value="Passport">Passport</option>
        <option value="Other">Any other Govt Notified document</option>
      </select>
    </div>

    <div class="col-md-6">
      <input type="text" class="form-control" [(ngModel)]="patient.idnum" name="idnum" placeholder="ID Number">
    </div>
    <div class="col-md-6">
      <input type="file" class="form-control" (change)="onAddressFileSelected($event)" accept="image/*">
    </div>
  </div>
</div>

        <hr>

        <!-- ========================= -->
        <!-- Caretakers Information -->
        <!-- ========================= -->
        <div class="card shadow-sm p-3 mt-3">
          <h5 class="mb-3"><i class="fa fa-users me-2"></i> Caretakers</h5>

          <div class="row" *ngFor="let ct of caretakers; let i = index">
            <div class="col-sm-4 mb-2">
              <input type="text" class="form-control" [(ngModel)]="ct.name" [name]="'cname' + i" placeholder="Name">
            </div>
            <div class="col-sm-4 mb-2">
              <input type="text" class="form-control" [(ngModel)]="ct.phone" [name]="'cphone' + i" placeholder="Phone Number">
            </div>
            <div class="col-sm-4 mb-2">
              <input type="email" class="form-control" [(ngModel)]="ct.email" [name]="'cemail' + i" placeholder="Email">
            </div>
            <div class="col-sm-6 mb-2">
              <select class="form-select" [(ngModel)]="ct.relation" [name]="'relation' + i">
                <option value="">-- Select Relation --</option>
                <option value="Son">Son</option>
                <option value="Daughter">Daughter</option>
                <option value="Mother">Mother</option>
                <option value="Father">Father</option>
                <option value="Wife">Wife</option>
                <option value="Brother">Brother</option>
              </select>
            </div>
            <div class="col-sm-5 mb-2">
              <input type="text" class="form-control" [(ngModel)]="ct.address" [name]="'address' + i" placeholder="Address">
            </div>
            <div class="col-sm-1 mb-2 d-flex align-items-center">
              <button type="button" class="btn btn-danger btn-sm" (click)="removeCaretaker(i)">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </div>

          <div class="mt-2">
            <button type="button" class="btn btn-sm btn-primary" (click)="addCaretaker()" [disabled]="caretakers.length >= 5">
              <i class="fa fa-plus"></i> Add Caretaker
            </button>
          </div>
        </div>

        <hr>

        <!-- TODO: Habits, Questions, Insurance (your previous code continues here, unchanged except for same [name] fix in hospital loop) -->

<hr>

        <!-- ========================= -->
        <!-- Habits -->
        <!-- ========================= -->
<div class="card shadow-sm p-4 mb-4 habits-card animate__animated animate__fadeInUp">
  <div class="row clearfix">
    <div class="headers">
      <h4 class="headings"><i class="fas fa-heartbeat text-danger me-2"></i> Patient Habits</h4>
    </div>
  </div>

  <div class="row mt-3 g-3">

    <!-- Habit Card Template -->
    <div class="col-lg-3 col-md-6">
      <div class="habit-card text-center p-3">
        <div class="habit-icon">
          <img src="../../../assets/tobacco.png" alt="Tobacco">
        </div>
        <h6 class="habit-title">Tobacco?</h6>

        <div class="btn-container my-2">
          <label class="switch btn-color-mode-switch">
            <input type="radio" name="tobacco" [(ngModel)]="habits.tobacco" value="yes">
            <span class="btn-color-mode-switch-inner yes">Yes</span>
          </label>
          <label class="switch btn-color-mode-switch">
            <input type="radio" name="tobacco" [(ngModel)]="habits.tobacco" value="no">
            <span class="btn-color-mode-switch-inner no">No</span>
          </label>
        </div>

        <!-- Show only if Yes -->
        <div class="mt-2" *ngIf="habits.tobacco === 'yes'">
          <p class="mb-1">For How Many Years</p>
          <input [(ngModel)]="habits.tobaccoYears" name="tobaccoYears" class="form-range" type="range" min="1" max="50">
          <p class="mt-1"><strong>{{ habits.tobaccoYears }} years</strong></p>
        </div>
      </div>
    </div>

    <!-- Smoking -->
    <div class="col-lg-3 col-md-6">
      <div class="habit-card text-center p-3">
        <div class="habit-icon">
          <img src="../../../assets/cigarette.png" alt="Smoking">
        </div>
        <h6 class="habit-title">Smoking Habit?</h6>

        <div class="btn-container my-2">
          <label class="switch btn-color-mode-switch">
            <input type="radio" name="smoking" [(ngModel)]="habits.smoking" value="yes">
            <span class="btn-color-mode-switch-inner yes">Yes</span>
          </label>
          <label class="switch btn-color-mode-switch">
            <input type="radio" name="smoking" [(ngModel)]="habits.smoking" value="no">
            <span class="btn-color-mode-switch-inner no">No</span>
          </label>
        </div>

        <div class="mt-2" *ngIf="habits.smoking === 'yes'">
          <p class="mb-1">For How Many Years</p>
          <input [(ngModel)]="habits.smokingYears" name="smokingYears" class="form-range" type="range" min="1" max="50">
          <p class="mt-1"><strong>{{ habits.smokingYears }} years</strong></p>
        </div>
      </div>
    </div>

    <!-- Alcohol -->
    <div class="col-lg-3 col-md-6">
      <div class="habit-card text-center p-3">
        <div class="habit-icon">
          <img src="../../../assets/beer.png" alt="Alcohol">
        </div>
        <h6 class="habit-title">Alcohol Habit?</h6>

        <div class="btn-container my-2">
          <label class="switch btn-color-mode-switch">
            <input type="radio" name="alcohol" [(ngModel)]="habits.alcohol" value="yes">
            <span class="btn-color-mode-switch-inner yes">Yes</span>
          </label>
          <label class="switch btn-color-mode-switch">
            <input type="radio" name="alcohol" [(ngModel)]="habits.alcohol" value="no">
            <span class="btn-color-mode-switch-inner no">No</span>
          </label>
        </div>

        <div class="mt-2" *ngIf="habits.alcohol === 'yes'">
          <p class="mb-1">For How Many Years</p>
          <input [(ngModel)]="habits.alcoholYears" name="alcoholYears" class="form-range" type="range" min="1" max="50">
          <p class="mt-1"><strong>{{ habits.alcoholYears }} years</strong></p>
        </div>
      </div>
    </div>

    <!-- Drugs -->
    <div class="col-lg-3 col-md-6">
      <div class="habit-card text-center p-3">
        <div class="habit-icon">
          <img src="../../../assets/capsule.png" alt="Drugs">
        </div>
        <h6 class="habit-title">Drug Use?</h6>

        <div class="btn-container my-2">
          <label class="switch btn-color-mode-switch">
            <input type="radio" name="drugs" [(ngModel)]="habits.drugs" value="yes">
            <span class="btn-color-mode-switch-inner yes">Yes</span>
          </label>
          <label class="switch btn-color-mode-switch">
            <input type="radio" name="drugs" [(ngModel)]="habits.drugs" value="no">
            <span class="btn-color-mode-switch-inner no">No</span>
          </label>
        </div>

        <div class="mt-2" *ngIf="habits.drugs === 'yes'">
          <p class="mb-1">For How Many Years</p>
          <input [(ngModel)]="habits.drugYears" name="drugYears" class="form-range" type="range" min="1" max="50">
          <p class="mt-1"><strong>{{ habits.drugYears }} years</strong></p>
        </div>
      </div>
    </div>

  </div>
</div>
<hr>
<div class="row mt-1">
  <!-- Question 1 -->
  <div class="card col-lg-4">
    <div class="row tp">
      <div>
        <p>
          Is the person proposed in good health free from physical and mental disease or infirmity?
          If not, give details.
        </p>
        <div class="btn-container">
          <label class="switch btn-color-mode-switch brd">
            <input type="radio" name="q1_answer" [(ngModel)]="questions.q1.answer" value="yes">
            <span class="btn-color-mode-switch-inner yes">Yes</span>
          </label>
          <label class="switch btn-color-mode-switch brd1">
            <input type="radio" name="q1_answer" [(ngModel)]="questions.q1.answer" value="no">
            <span class="btn-color-mode-switch-inner no">No</span>
          </label>
        </div>
      </div>

      <!-- Show textarea only if Yes -->
      <div class="mt-2" *ngIf="questions.q1.answer === 'yes'" style="width: 100%;">
        <div class="form-group">
          <label for="q1Details">Add More Details About health issue</label>
          <textarea id="q1Details" class="form-control" [(ngModel)]="questions.q1.details" 
                    name="q1_details" rows="3"></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Question 2 -->
  <div class="card col-lg-4">
    <div class="row tp">
      <div>
        <p>
          Has the person proposed consulted / diagnosed / taken treatment / been admitted for any illness / injury?
        </p>
        <div class="btn-container">
          <label class="switch btn-color-mode-switch brd">
            <input type="radio" name="q2_answer" [(ngModel)]="questions.q2.answer" value="yes">
            <span class="btn-color-mode-switch-inner yes">Yes</span>
          </label>
          <label class="switch btn-color-mode-switch brd1">
            <input type="radio" name="q2_answer" [(ngModel)]="questions.q2.answer" value="no">
            <span class="btn-color-mode-switch-inner no">No</span>
          </label>
        </div>
      </div>

      <div class="mt-2" *ngIf="questions.q2.answer === 'yes'" style="width: 100%;">
        <div class="form-group">
          <label for="q2Details">Add More Details About health issue</label>
          <textarea id="q2Details" class="form-control" [(ngModel)]="questions.q2.details" 
                    name="q2_details" rows="3"></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Question 3 -->
  <div class="card col-lg-4">
    <div class="row tp">
      <div>
        <p>Does the person proposed have any complications during / following birth?</p>
        <div class="btn-container" style="margin-top: 20px;">
          <label class="switch btn-color-mode-switch brd">
            <input type="radio" name="q3_answer" [(ngModel)]="questions.q3.answer" value="yes">
            <span class="btn-color-mode-switch-inner yes">Yes</span>
          </label>
          <label class="switch btn-color-mode-switch brd1">
            <input type="radio" name="q3_answer" [(ngModel)]="questions.q3.answer" value="no">
            <span class="btn-color-mode-switch-inner no">No</span>
          </label>
        </div>
      </div>

      <div class="mt-2" *ngIf="questions.q3.answer === 'yes'" style="width: 100%;">
        <div class="form-group">
          <label for="q3Details">Add More Details</label>
          <textarea id="q3Details" class="form-control" [(ngModel)]="questions.q3.details" 
                    name="q3_details" rows="3"></textarea>
        </div>
      </div>
    </div>
  </div>
</div>
    <hr>


    <!-- Insurance Company -->
   <div class="card insurance-card">
  <div class="card-header">
    <h5>Insurance Details</h5>
  </div>
  <div class="card-body">
    <!-- Row 1 -->
    <div class="row mb-3">
      <div class="col-sm-4">
        <input type="text" class="form-control"
          [(ngModel)]="insuranceDetails.insuranceCompany" name="insuranceCompany"
          placeholder="Name of Insurance Company">
      </div>
      <div class="col-sm-4">
        <input type="text" class="form-control"
          [(ngModel)]="insuranceDetails.periodInsurance" name="periodInsurance"
          placeholder="Period of Insurance">
      </div>
      <div class="col-sm-4">
        <input type="text" class="form-control"
          [(ngModel)]="insuranceDetails.sumInsured" name="sumInsured"
          placeholder="Sum Insured">
      </div>
    </div>

    <!-- Policy Files -->
    <div class="row mb-3">
      <div class="col-sm-6">
        <label class="form-label">Attach policy document copy</label>
        <input type="file" class="form-control" multiple (change)="onFileChange($event)">
      </div>
      <div class="col-sm-6">
        <label class="form-label">Declined Insurance Coverage?</label>
        <select class="form-control" [(ngModel)]="insuranceDetails.declinedCoverage" name="declinedCoverage">
          <option value="">Select an option</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>
      </div>
    </div>

    <!-- Similar Insurance -->
    <div class="mb-3">
      <label class="form-label">Other similar insurance/s taken</label>
      <input type="text" class="form-control"
        [(ngModel)]="insuranceDetails.similarInsurances" name="similarInsurances"
        placeholder="Enter details of similar insurance/s">
    </div>

    <!-- Hospital Preferences -->
    <div class="mb-3">
      <label class="form-label">Hospital Preferences</label>
      <div *ngFor="let hospital of insuranceDetails.hospitals; let i = index" class="row mb-2">
        <div class="col-sm-5">
          <input type="text" class="form-control"
            [(ngModel)]="hospital.hospitalName" name="hospitalName{{i}}"
            placeholder="Hospital Name">
        </div>
        <div class="col-sm-5">
          <input type="text" class="form-control"
            [(ngModel)]="hospital.hospitalAddress" name="hospitalAddress{{i}}"
            placeholder="Hospital Address">
        </div>
        <div class="col-sm-2 d-flex">
          <button type="button" class="btn btn-success me-2"
            (click)="addHospital()"
            [disabled]="insuranceDetails.hospitals.length >= 5">+</button>
          <button *ngIf="i > 0" type="button" class="btn btn-danger" (click)="removeHospital(i)">-</button>
        </div>
      </div>
    </div>

    <!-- Package -->
    <div class="row mb-3">
      <div class="col-sm-6">
        <label class="form-label">Select Package</label>
        <select class="form-control" [(ngModel)]="insuranceDetails.package" name="package">
          <option value="" disabled>Select Package</option>
          <option value="integral">INTEGRAL</option>
          <option value="prime">PRIME</option>
          <option value="elite">ELITE</option>
        </select>
      </div>

      <div class="col-sm-6">
        <label class="form-label">Package Details</label>
        <select class="form-control" [(ngModel)]="insuranceDetails.packageDetail" name="packageDetail">
          <option value="" disabled>Please select an option</option>
          <option *ngFor="let option of packageDetails[insuranceDetails.package]" [value]="option">
            {{ option }}
          </option>
        </select>
      </div>
    </div>
  </div>
</div>

        <!-- Submit -->
        <button type="submit" class="btn btn-primary mt-3">
          {{ isEditMode ? 'Update Patient' : 'Save Patient' }}
        </button>
      
    
  </form>
</div>
